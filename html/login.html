<!DOCTYPE html>
<html>
  <head>
    <title>Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style type="text/tailwindcss">
      @layer base {
        html {
          font-family: "Geist Mono", system-ui, sans-serif;
        }
      }
    </style>
  </head>

  <body class="bg-gray-950 p-8 text-white flex items-center flex-col">
    <h1 class="text-2xl font-semibold">
      Welcome to <span class="italic">Not Discord</span>
    </h1>
    <p class="text-gray-300">Please login to continue</p>
    <div class="w-96 bg-gray-900 rounded-lg p-6 mt-6">
      <form id="signinForm" class="flex flex-col" onsubmit="signin(event)">
        <label class="text-sm">Email address</label>
        <input
          name="email"
          type="email"
          placeholder="Email"
          class="mt-2 bg-transparent text-sm h-9 rounded-md ring ring-gray-700 ring-2 p-2 focus:outline-none focus:ring-pink-400"
        />
        <label class="text-sm mt-3">Password</label>
        <input
          name="password"
          type="password"
          placeholder="Password"
          class="mt-2 bg-transparent text-sm h-9 rounded-md ring ring-gray-700 ring-2 p-2 focus:outline-none focus:ring-pink-400"
        />
        <button class="mt-4 bg-pink-500 rounded-md h-10 hover:bg-pink-600">
          Login
        </button>
        <p id="signinErrMsg" class="text-red-500 text-sm mt-2"></p>
        <p class="text-sm mt-3 text-gray-300">
          Don't have an account?
          <button type="button" class="underline" onclick="showSignup()">
            Sign up
          </button>
        </p>
      </form>
      <form id="signupForm" class="flex flex-col" style="display: none">
        <label class="text-sm">Username</label>
        <input
          name="username"
          placeholder="Username"
          class="mt-2 bg-transparent text-sm h-9 rounded-md ring ring-gray-700 ring-2 p-2 focus:outline-none focus:ring-pink-400"
        />
        <label class="text-sm mt-3">Email address</label>
        <input
          name="email"
          type="email"
          placeholder="Email"
          class="mt-2 bg-transparent text-sm h-9 rounded-md ring ring-gray-700 ring-2 p-2 focus:outline-none focus:ring-pink-400"
        />
        <label class="text-sm mt-3">Password</label>
        <input
          name="password"
          type="password"
          placeholder="Password"
          class="mt-2 bg-transparent text-sm h-9 rounded-md ring ring-gray-700 ring-2 p-2 focus:outline-none focus:ring-pink-400"
        />
        <button class="mt-4 bg-pink-500 rounded-md h-10 hover:bg-pink-600">
          Sign up
        </button>
        <p id="signupErrMsg" class="text-red-500 text-sm mt-2"></p>
        <p class="text-sm mt-3 text-gray-300">
          Need an account?
          <button type="button" class="underline" onclick="showSignin()">
            Sign in
          </button>
        </p>
      </form>
    </div>
  </body>
  <script>
    function showSignup() {
      document.getElementById("signinForm").style.display = "none";
      document.getElementById("signupForm").style.display = "flex";
      clearErrMsgs();
    }
    function showSignin() {
      document.getElementById("signupForm").style.display = "none";
      document.getElementById("signinForm").style.display = "flex";
      clearErrMsgs();
    }
    function clearErrMsgs() {
      document.getElementById("signinErrMsg").innerHTML = "";
      document.getElementById("signupErrMsg").innerHTML = "";
    }
    async function signin(e) {
      clearErrMsgs();
      e.preventDefault();
      const formData = new FormData(e.target);
      const response = await fetch("/api/login", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          email: formData.get("email"),
          password: formData.get("password"),
        }),
      });
      if (!response.ok) {
        const responseJson = await response.json();
        console.log(responseJson["error"]);
        document.getElementById("signinErrMsg").innerHTML =
          responseJson["error"];
      }
    }
  </script>
</html>
